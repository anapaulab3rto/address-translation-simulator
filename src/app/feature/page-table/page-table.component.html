<div class="main-container">

  <div class="input-address widget">
    <h3>Inserir Endereço Virtual</h3>
    <div class="input-group">
      <fieldset>
        <legend>Novo processo</legend>
        <div class="proc-actions-inputs">
          <input type="number" [(ngModel)]="newProcessID" placeholder="ID" />
          <input type="text" [(ngModel)]="newProcessName" placeholder="Nome" />
        </div>
        <button class="btn" (click)="createProcess()">Criar Processo</button>
      </fieldset>

      <fieldset>
        <legend>Traduzir Endereço</legend>
        <label>
          Processo:
          <select [(ngModel)]="pid" (ngModelChange)="selectProcess()">
            @for (p of processes; track $index) {
              <option [value]="p.pid">PID {{p.pid}} — {{p.name}}</option>
            }
          </select>
        </label>
        <label>
          Endereço virtual:
          <input type="number" [(ngModel)]="virtual" placeholder="Ex: 40" />
        </label>
        <button type="button" class="btn" (click)="translate()">Traduzir</button>
      </fieldset>
    </div>
  </div>

  <div class="pagetable-widget widget">
    <h3>Tabela de Páginas</h3>
    @if (active()) {
      <div>
        <p class="active-process-info">
          <strong>Ativo:</strong> PID {{ active()?.pid }} — {{ active()?.name }}
        </p>

        <table class="page-table responsive-table">
          <thead>
            <tr>
              <th>Página</th>
              <th>Válida</th>
              <th>Quadro</th>
              <th>Endereço Físico</th>
            </tr>
          </thead>
          <tbody>
            @for (p of entries; track $index) {
              <tr [class.row-invalid]="!p.valid">
                <td data-label="Página">{{ p.pageNumber }}</td>
                <td data-label="Válida">
                  <span [class]="p.valid ? 'status status-valid' : 'status status-invalid'">
                    {{ p.valid ? 'Sim' : 'Não' }}
                  </span>
                </td>
                <td data-label="Quadro">{{ p.frameNumber !== undefined ? p.frameNumber : '-' }}</td>
                <td data-label="Endereço">
                  <button type="button" class="btn-sm" (click)="p.showAddress = !p.showAddress">
                    {{ p.showAddress ? 'Ocultar' : 'Revelar' }}
                  </button>
                  @if (p.showAddress && p.frameNumber !== undefined && p.offset !== undefined) {
                    <span class="physical-address">{{ p.frameNumber + p.offset }}</span>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    } @else {
      <div class="empty-state">
        <p>Nenhum processo ativo.</p>
        <span>Crie ou selecione um processo no painel de entrada.</span>
      </div>
    }
  </div>

</div>
